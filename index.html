<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aircraft Game</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
    touch-action: none;
  }
  canvas {
    display: block;
    background: url("assets/background.png") repeat-y center/cover;
  }
  #popup {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
    background: rgba(0,0,0,0.7);
    color: #00ff88;
    font-family: sans-serif;
    padding: 10px 20px;
    border-radius: 10px;
    display: none;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="popup"></div>
<audio id="bgm" src="sounds/bgm.mpeg" loop></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// Load assets
const load = (src) => { const i = new Image(); i.src = src; return i; };
const background = load("assets/background.png");
const playerImg = load("assets/player.png");
const enemyImg = load("assets/enemy.png");
const bossImg = load("assets/boss.png");
const bulletGreen = load("assets/bullet_green.png");
const bulletRed = load("assets/bullet_red.png");
const powerDouble = load("assets/power_double_fire.png");
const powerShield = load("assets/power_shield.png");
const powerLife = load("assets/power_extra_life.png");

let bgY = 0, score = 0, lives = 3;
let doubleFire = false, shield = false;
let enemies = [], bullets = [], enemyBullets = [], power = null, boss = null;

const player = {
  x: canvas.width / 2 - 40,
  y: canvas.height - 150,
  width: 80,
  height: 80,
  speed: 8
};

const bgm = document.getElementById("bgm");
bgm.play().catch(()=>document.body.addEventListener("click",()=>bgm.play(),{once:true}));

// ðŸ”¥ Player bullet (every 0.2 sec)
setInterval(()=>{
  if(doubleFire){
    bullets.push({x:player.x+10,y:player.y,width:15,height:30});
    bullets.push({x:player.x+player.width-25,y:player.y,width:15,height:30});
  } else {
    bullets.push({x:player.x+player.width/2-8,y:player.y,width:15,height:30});
  }
},200);

// ðŸ§¨ Enemy spawn every 2.6 sec
setInterval(()=>{
  enemies.push({x:Math.random()*(canvas.width-60),y:-60,width:60,height:60,hp:1});
},2600);

// ðŸ’£ Enemy fire every 2 sec
setInterval(()=>{
  enemies.forEach(e=>{
    enemyBullets.push({x:e.x+e.width/2-5,y:e.y+e.height,width:10,height:20});
  });
},2000);

// âš¡ Power spawn every 2 sec
setInterval(()=>{
  if(!power){
    const types=["double","shield","life"];
    const t=types[Math.floor(Math.random()*types.length)];
    power={type:t,x:Math.random()*(canvas.width-50),y:-50,width:50,height:50};
  }
},2000);

// ðŸ‘¹ Boss spawn every 200 points
function spawnBoss(){
  if(score>=200 && score%200===0){
    boss={x:canvas.width/2-100,y:60,width:200,height:200,hp:10};
  }
}

// ðŸ– Swipe + drag control
let startX=null, dragging=false;
canvas.addEventListener("touchstart",e=>{startX=e.touches[0].clientX;});
canvas.addEventListener("touchmove",e=>{
  const x=e.touches[0].clientX;
  const dx=x-startX;
  player.x+=dx;
  if(player.x<0)player.x=0;
  if(player.x>canvas.width-player.width)player.x=canvas.width-player.width;
  startX=x;
});
canvas.addEventListener("mousedown",e=>{dragging=true;startX=e.clientX;});
canvas.addEventListener("mousemove",e=>{
  if(dragging){
    const dx=e.clientX-startX;
    player.x+=dx;
    if(player.x<0)player.x=0;
    if(player.x>canvas.width-player.width)player.x=canvas.width-player.width;
    startX=e.clientX;
  }
});
canvas.addEventListener("mouseup",()=>dragging=false);
canvas.addEventListener("mouseleave",()=>dragging=false);

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  bgY+=2;
  if(bgY>=canvas.height) bgY=0;
  ctx.drawImage(background,0,bgY-canvas.height,canvas.width,canvas.height);
  ctx.drawImage(background,0,bgY,canvas.width,canvas.height);

  // Player
  ctx.drawImage(playerImg,player.x,player.y,player.width,player.height);

  // Bullets
  bullets.forEach((b,i)=>{
    b.y-=12;
    ctx.drawImage(bulletGreen,b.x,b.y,b.width,b.height);
    if(b.y<0) bullets.splice(i,1);
  });

  // Enemies
  enemies.forEach((e,ei)=>{
    e.y+=3;
    ctx.drawImage(enemyImg,e.x,e.y,e.width,e.height);
    if(e.y>canvas.height) enemies.splice(ei,1);

    bullets.forEach((b,bi)=>{
      if(b.x<e.x+e.width && b.x+b.width>e.x && b.y<e.y+e.height && b.y+b.height>e.y){
        enemies.splice(ei,1);
        bullets.splice(bi,1);
        score+=10;
        spawnBoss();
      }
    });
  });

  // Enemy bullets
  enemyBullets.forEach((eb,ei)=>{
    eb.y+=7;
    ctx.drawImage(bulletRed,eb.x,eb.y,eb.width,eb.height);
    if(eb.y>canvas.height) enemyBullets.splice(ei,1);
  });

  // Power
  if(power){
    power.y+=3;
    let imgP=powerDouble;
    if(power.type==="shield") imgP=powerShield;
    if(power.type==="life") imgP=powerLife;
    ctx.drawImage(imgP,power.x,power.y,power.width,power.height);

    if(power.y>canvas.height) power=null;
    if(power && player.x<power.x+power.width && player.x+player.width>power.x &&
       player.y<power.y+power.height && player.y+player.height>power.y){
      if(power.type==="double") doubleFire=true;
      if(power.type==="shield") shield=true;
      if(power.type==="life") lives++;
      power=null;
    }
  }

  // Boss
  if(boss){
    ctx.drawImage(bossImg,boss.x,boss.y,boss.width,boss.height);
    boss.hp<=0 && (boss=null, score+=100);
  }

  // UI
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,20,30);
  ctx.fillText("Lives: "+lives,20,60);
  requestAnimationFrame(draw);
}
draw();
</script>
</body>
</html>
