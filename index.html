<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aircraft Game</title>

    <style>
        /* Basic styling to center the game and give it a border */
        body {
            background-color: #333;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            /* Prevents scrolling on mobile */
            overflow: hidden; 
        }

        h1 {
            margin: 1rem;
        }

        canvas {
            background-color: #000; /* Fallback if background image fails */
            border: 3px solid #fff;
            border-radius: 5px;
            /* Cursors are not needed on mobile, but good for testing on PC */
            cursor: none; 
        }
    </style>
</head>
<body>

    <h1>Aircraft Shooter</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        // Get the canvas and its 2D rendering context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // --- Game Variables ---
        let playerX = canvas.width / 2 - 25; // Start player in middle-bottom
        let playerY = canvas.height - 70;
        const playerWidth = 50;
        const playerHeight = 50;

        // --- Game State Variables ---
        let playerHealth = 3;
        const maxPlayerHealth = 3;
        let score = 0;
        let nextBossScore = 200; // The score to reach for the first boss
        let bossActive = false;
        let bossHealth = 50;

        // --- Load Assets ---

        // Load background image
        const bgImage = new Image();
        bgImage.src = 'assets/background.png';

        // Load player image
        const playerImage = new Image();
        playerImage.src = 'assets/player.png';

        // Load heart image
        const heartImage = new Image();
        heartImage.src = 'assets/heart.png';

        // --- Mobile Touch Controls ---

        // Helper function to get touch position relative to the canvas
        function getTouchPos(canvasDom, touchEvent) {
            const rect = canvasDom.getBoundingClientRect();
            return {
                x: touchEvent.touches[0].clientX - rect.left,
                y: touchEvent.touches[0].clientY - rect.top
            };
        }

        // Listen for touch start
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Prevent screen from scrolling
            const touchPos = getTouchPos(canvas, e);
            // Center the player on the touch
            playerX = touchPos.x - playerWidth / 2;
            playerY = touchPos.y - playerHeight / 2;
        }, false);

        // Listen for touch movement
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Prevent screen from scrolling
            const touchPos = getTouchPos(canvas, e);
            // Center the player on the touch
            playerX = touchPos.x - playerWidth / 2;
            playerY = touchPos.y - playerHeight / 2;
        }, false);


        // --- Main Game Loop ---
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // Keep player within canvas bounds (touch controls can go out)
            if (playerX < 0) playerX = 0;
            if (playerX > canvas.width - playerWidth) playerX = canvas.width - playerWidth;
            if (playerY < 0) playerY = 0;
            if (playerY > canvas.height - playerHeight) playerY = canvas.height - playerHeight;

            // --- Boss Spawn Logic ---
            if (!bossActive && score >= nextBossScore) {
                spawnBoss();
            }

            // --- Future update code goes here ---
            // e.g., updateBullets();
            // e.g., updateEnemies();
            // e.g., if (bossActive) updateBoss();
        }

        function draw() {
            // Clear the entire canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the background
            ctx.drawImage(bgImage, 0, 0, canvas.width, canvas.height);

            // Draw the player
            ctx.drawImage(playerImage, playerX, playerY, playerWidth, playerHeight);

            // --- Future drawing code goes here ---
            // e.g., drawBullets();
            // e.g., drawEnemies();
            // e.g., if (bossActive) drawBoss();

            // Draw the UI (score and health) on top of everything
            drawUI();
        }

        // --- Function to draw UI ---
        function drawUI() {
            // Draw Score
            ctx.fillStyle = 'white';
            ctx.font = '24px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`Score: ${score}`, 10, 30);

            // Draw Hearts
            const heartWidth = 30;
            const heartHeight = 30;
            const heartPadding = 5;
            for (let i = 0; i < playerHealth; i++) {
                // Draw hearts from the right side of the screen
                const heartX = canvas.width - (i + 1) * (heartWidth + heartPadding);
                const heartY = 10;
                ctx.drawImage(heartImage, heartX, heartY, heartWidth, heartHeight);
            }
        }

        // --- Game Logic Functions ---

        /**
         * Call this when an enemy is killed.
         */
        function enemyKilled() {
            score += 10;
            console.log(`Score is now: ${score}`);
        }

        /**
         * Call this when the player is hit by an enemy or bullet.
         */
        function playerHit() {
            playerHealth--;
            console.log(`Player hit! Health is now: ${playerHealth}`);
            if (playerHealth <= 0) {
                // Game Over logic
                console.log("GAME OVER");
                // For now, just reset
                playerHealth = 3;
                score = 0;
                nextBossScore = 200;
            }
        }

        /**
         * Call this when the player picks up the 'power_extra_life.png'
         */
        function addLife() {
            if (playerHealth < maxPlayerHealth) {
                playerHealth++;
                console.log(`Gained a life! Health is now: ${playerHealth}`);
            }
        }

        /**
         * Call this to spawn the boss.
         */
        function spawnBoss() {
            console.log("BOSS BATTLE START!");
            bossActive = true;
            bossHealth = 50; // Reset boss health
            // Set the score needed for the *next* boss
            nextBossScore += 200; 

            // (Future logic: stop regular enemies, spawn the boss object)
        }

        /**
         * Call this when the boss is hit by a player bullet.
         */
        function bossHit() {
            bossHealth--;
            if (bossHealth <= 0) {
                console.log("BOSS DEFEATED!");
                bossActive = false;
                score += 100; // Bonus for boss
                // (Future logic: restart regular enemies)
            }
        }


        // --- Start the Game ---

        // We need to wait for ALL images to load
        let assetsLoaded = 0;
        const totalAssets = 3; // bg, player, heart

        function assetLoaded() {
            assetsLoaded++;
            if (assetsLoaded === totalAssets) {
                // Set canvas to fill the screen
                resizeCanvas();
                // Start the game!
                gameLoop(); 
            }
        }

        // --- NEW: Resize Canvas Function ---
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Re-center player if canvas is resized
            playerY = canvas.height - 70;
            playerX = canvas.width / 2 - playerWidth / 2;
        }
        
        // Resize canvas when the window is resized
        window.addEventListener('resize', resizeCanvas);

        // Load images and start game
        bgImage.onload = assetLoaded;
        playerImage.onload = assetLoaded;
        heartImage.onload = assetLoaded;

        bgImage.onerror = () => console.error("Error loading background.png");
        playerImage.onerror = () => console.error("Error loading player.png");
        heartImage.onerror = () => console.error("Error loading heart.png");

    </script>
</body>
</html>
