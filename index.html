<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Aircraft Game</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { overflow: hidden; background: black; }
  canvas { display: block; margin: auto; background: url('./assets/background.png') repeat-y; background-size: cover; }
  #lives { position: absolute; top: 10px; left: 10px; display: flex; gap: 5px; }
  #lives img { width: 30px; height: 30px; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="480" height="800"></canvas>
<div id="lives"></div>
<audio id="bgm" src="./sounds/bgm.mpeg" loop></audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const bgm = document.getElementById("bgm");
bgm.volume = 0.5;
bgm.play().catch(()=>{});

const playerImg = new Image(); playerImg.src = "./assets/player.png";
const enemyImg = new Image(); enemyImg.src = "./assets/enemy.png";
const bossImg = new Image(); bossImg.src = "./assets/boss.png";
const bulletGreen = new Image(); bulletGreen.src = "./assets/bullet_green.png";
const bulletRed = new Image(); bulletRed.src = "./assets/bullet_red.png";
const heartImg = new Image(); heartImg.src = "./assets/heart.png";

let player = { x: canvas.width/2-25, y: canvas.height-100, w: 50, h: 50, bullets: [], canShoot:true };
let enemies = [], enemyBullets = [], powers = [], boss = null, bossBullets = [];
let score = 0, lives = 3, lastEnemySpawn = 0, enemySpawnInterval = 2600, lastFire = 0;
let lastBossSpawn = 0, bossInterval = 200, bossFireCooldown = 0;

function drawLives(){
  const livesDiv = document.getElementById("lives");
  livesDiv.innerHTML = '';
  for(let i=0;i<lives;i++){
    const img = document.createElement('img');
    img.src = "./assets/heart.png";
    livesDiv.appendChild(img);
  }
}
drawLives();

function spawnEnemy(){
  enemies.push({ x: Math.random()*(canvas.width-50), y: -60, w: 50, h: 50 });
}
function spawnBoss(){
  boss = { x: canvas.width/2-75, y: 50, w:150, h:150, hp:30 };
}
function shootBullet(){
  if(!player.canShoot) return;
  player.bullets.push({x: player.x+player.w/2-5, y: player.y, w:10, h:20});
  player.canShoot=false;
  setTimeout(()=>player.canShoot=true,200);
}

function moveEverything(delta){
  player.bullets.forEach(b=>b.y-=300*delta);
  player.bullets = player.bullets.filter(b=>b.y>-20);
  enemies.forEach(e=>e.y+=100*delta);
  enemies = enemies.filter(e=>e.y<canvas.height+50);
  enemyBullets.forEach(b=>b.y+=200*delta);
  enemyBullets = enemyBullets.filter(b=>b.y<canvas.height+20);
  if(boss){
    bossBullets.forEach(b=>b.y+=300*delta);
    bossBullets = bossBullets.filter(b=>b.y<canvas.height+20);
  }
}

function enemyFire(){
  enemies.forEach(e=>{
    enemyBullets.push({x:e.x+e.w/2-5, y:e.y+e.h, w:10, h:20});
  });
}
function bossFire(){
  if(!boss) return;
  bossBullets.push({x: boss.x+boss.w/2-5, y: boss.y+boss.h, w:10, h:20});
}

function checkCollisions(){
  player.bullets.forEach((b,i)=>{
    enemies.forEach((e,j)=>{
      if(b.x<e.x+e.w && b.x+b.w>e.x && b.y<e.y+e.h && b.y+b.h>e.y){
        player.bullets.splice(i,1); enemies.splice(j,1); score+=10;
      }
    });
    if(boss && b.x<boss.x+boss.w && b.x+b.w>boss.x && b.y<boss.y+boss.h && b.y+b.h>boss.y){
      player.bullets.splice(i,1);
      boss.hp--;
      if(boss.hp<=0){ boss=null; score+=100; }
    }
  });
  enemyBullets.forEach((b,i)=>{
    if(b.x<player.x+player.w && b.x+b.w>player.x && b.y<player.y+player.h && b.y+b.h>player.y){
      enemyBullets.splice(i,1);
      lives--; drawLives();
      if(lives<=0){ alert("Game Over! Score: "+score); document.location.reload(); }
    }
  });
  if(boss){
    bossBullets.forEach((b,i)=>{
      if(b.x<player.x+player.w && b.x+b.w>player.x && b.y<player.y+player.h && b.y+b.h>player.y){
        bossBullets.splice(i,1);
        lives--; drawLives();
        if(lives<=0){ alert("Game Over! Score: "+score); document.location.reload(); }
      }
    });
  }
}

let lastTime=0;
function loop(time){
  const delta=(time-lastTime)/1000; lastTime=time;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  moveEverything(delta);
  checkCollisions();

  ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);
  player.bullets.forEach(b=>ctx.drawImage(bulletGreen,b.x,b.y,b.w,b.h));
  enemies.forEach(e=>ctx.drawImage(enemyImg,e.x,e.y,e.w,e.h));
  enemyBullets.forEach(b=>ctx.drawImage(bulletRed,b.x,b.y,b.w,b.h));
  if(boss){
    ctx.drawImage(bossImg,boss.x,boss.y,boss.w,boss.h);
    bossBullets.forEach(b=>ctx.drawImage(bulletRed,b.x,b.y,b.w,b.h));
  }

  if(time-lastEnemySpawn>enemySpawnInterval){
    spawnEnemy(); lastEnemySpawn=time;
  }
  if(time-lastFire>2000){ enemyFire(); lastFire=time; }

  if(score>=lastBossSpawn+bossInterval){
    spawnBoss(); lastBossSpawn=score;
  }
  if(boss){
    bossFireCooldown+=delta;
    if(bossFireCooldown>2){ bossFire(); bossFireCooldown=0; }
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

let dragging=false, offsetX=0;
canvas.addEventListener("mousedown",e=>{
  if(e.offsetX>player.x && e.offsetX<player.x+player.w && e.offsetY>player.y && e.offsetY<player.y+player.h){
    dragging=true; offsetX=e.offsetX-player.x;
  }
});
canvas.addEventListener("mouseup",()=>dragging=false);
canvas.addEventListener("mousemove",e=>{
  if(dragging){
    player.x=e.offsetX-offsetX;
    if(player.x<0) player.x=0;
    if(player.x>canvas.width-player.w) player.x=canvas.width-player.w;
  }
});

canvas.addEventListener("touchstart",e=>{
  const touch=e.touches[0];
  if(touch.clientX>player.x && touch.clientX<player.x+player.w && touch.clientY>player.y && touch.clientY<player.y+player.h){
    dragging=true; offsetX=touch.clientX-player.x;
  }
});
canvas.addEventListener("touchend",()=>dragging=false);
canvas.addEventListener("touchmove",e=>{
  if(dragging){
    const touch=e.touches[0];
    player.x=touch.clientX-offsetX;
    if(player.x<0) player.x=0;
    if(player.x>canvas.width-player.w) player.x=canvas.width-player.w;
  }
});

window.addEventListener("keydown",e=>{
  if(e.code==="Space") shootBullet();
});
canvas.addEventListener("click",shootBullet);
</script>
</body>
</html>
